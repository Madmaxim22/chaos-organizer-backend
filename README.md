# Chaos Organizer Backend

Бэкенд-часть для проекта Chaos Organizer — бота-органайзера для хранения информации, поиска и сервисов, вдохновлённого функциональностью мессенджеров (Telegram, WhatsApp, Slack).

## Технологический стек

- **Фреймворк:** Koa (и сопутствующие middleware)
- **Протоколы:** HTTP, WebSocket (ws), Server-Sent Events (http-event-stream)
- **Хранение данных:** В памяти процесса (массивы, `Set`, `Map`)
- **Деплой:** Render (с поддержкой постоянного хранилища)

## Ключевые функции

- Сохранение истории сообщений (текст, ссылки, файлы)
- Ленивая подгрузка (пагинация) через параметры `offset` и `limit`
- Синхронизация между клиентами через WebSocket/SSE
- Поиск по сообщениям с фильтрацией по типу контента
- Обработка команд бота (минимум 5 команд)
- Шифрование сообщений с использованием crypto-js
- Напоминания с парсингом времени
- Экспорт/импорт истории в JSON/HTML
- Офлайн-режим с кешированием
- Архивирование файлов (zip.js)
- Поддержка оформления кода и смайликов

## Структура проекта

```
chaos-organizer-backend/
├── src/                    # Исходный код
├── public/                # Статические файлы
├── uploads/               # Загруженные файлы (с .gitkeep)
├── package.json           # Зависимости и скрипты
├── README.md              # Этот файл
├── BACKEND.md             # Детальная спецификация
├── STRUCTURE-BACKEND.md   # План разработки
└── .gitignore             # Исключения для Git
```

## Быстрый старт

1. Установите зависимости:

   ```bash
   npm install
   ```

2. Запустите сервер в режиме разработки:

   ```bash
   npm run dev
   ```

3. Сервер будет доступен по умолчанию на `http://localhost:3000`.

## API-эндпоинты

Основные эндпоинты:

- `GET /api/messages` – получение последних сообщений
- `POST /api/messages` – отправка нового сообщения
- `GET /api/messages/search` – поиск по сообщениям
- `GET /api/messages/:id` – получение конкретного сообщения
- `PUT /api/messages/:id/pin` – закрепление/открепление
- `PUT /api/messages/:id/favorite` – добавление/удаление из избранного
- `GET /api/attachments` – получение вложений по категориям
- `POST /api/commands` – выполнение команды бота
- `POST /api/reminders` – установка напоминания
- `GET /api/export` – экспорт истории
- `POST /api/import` – импорт истории

## WebSocket/SSE

Эндпоинт `/api/events` для получения событий в реальном времени:

- `new_message`
- `message_updated`
- `message_deleted`
- `sync_required`

## Зависимости

Основные зависимости указаны в `package.json`:

- koa, koa-router, koa-body, koa-static
- ws, http-event-stream
- crypto-js, zip.js

Разработочные зависимости: nodemon, eslint.

## Развёртывание

Проект настроен для деплоя на Render с использованием постоянного хранилища. Файлы в каталоге `uploads/` сохраняются между перезапусками.

## Лицензия

MIT